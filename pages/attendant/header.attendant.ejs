<div class="header d-flex" style="height:auto;padding-top: 20px;padding-bottom: 20px;">
  <% if (locals.username) { %>
  <div class="">
    <h4>
      <%= `${username}` %>
    </h4>
    <% if (locals.role) { %>
    <% if (role==='attendant' ) { %>
    <!-- <button onclick="saveCoupon()" class="btn btn-primary" style="text-transform: uppercase;">Registrar
            cupón</button> -->
    <% } %>
    <% } %>
  </div>
  <% } %>
</div>

<% if (locals.role) { %>
<% if (role==='attendant' ) { %>
<script>

  function saveCoupon() {
    const coupon = prompt('<%= translation.HOME.LABEL_6 %>');

    if (coupon) {
      if (confirm('<%= translation.HOME.IRREVERSIBLE %>')) {
        registerCoupon(coupon);
      } else {
        // console.log('no se guardó');
      }
    }
  }

  function registerCoupon(coupon) {
    const myHeaders = new Headers();
    myHeaders.append('Content-Type', 'application/json');

    fetch(`/api/v1/profile/coupon`, {
      headers: myHeaders,
      credentials: "same-origin",
      method: 'post',
      body: JSON.stringify({
        coupon
      })
    })
      .then(async (res) => {
        if (res.status === 201) {
          alert('<%= translation.HOME.LABEL_8 %>');
        } else if (res.status === 404) {
          alert('<%= translation.HOME.LABEL_9 %>');
        } else if (res.status === 400) {
          const body = await res.json();
          if (body) {
            alert(body.message);
          } else {
            alert('<%= translation.HOME.LABEL_10 %>');
          }
        } else if (res.status === 408) {
          const body = await res.json();
          if (body && body.message === 'token expired') {
            alert('<%= translation.HOME.EXPIRED_COUPON %>');
          } else {
            alert('<%= translation.HOME.LABEL_10 %>');
          }
        } else {
          alert('<%= translation.HOME.LABEL_10 %>');
        }
        location.reload(true);
      })
      .catch(err => {
        console.error(err);
      });

  }
</script>
<% } %>
<% } %>